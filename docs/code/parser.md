# __Summary__

This project is designed to parse the raw html from the USC COVID data page and convert it in a more usable csv. The generated csv is then validated and any erronious rows are removed to guarantee the output file is consistant. The validation ensures that each column in the csv matches the pattern described in the column description below. For each row in the csv, any columns that cannot be parsed will be entered as `null` to prevent uneven rows. Rows with null values could be post-processed later if needed. 

Since it is hard to do meaningful analysis on the data generated from covid data page alone, additional features have been added to enrich the output data. After the covid data page is parsed, an option to append building address to the end of the csv. This adds another two columns to each row of the csv with the full buiding name and street address. Since this process is automatic it is not perfect, any buildings who's address cannot be resolved will be entered as `null`. 

The appended data is added from output csv (`building_code_map.csv`) of the [parse_building_directory.py](../parse_building_directory) script. If this csv file doesnt exist, or if it is missconfigured then the parser will not be able to add the additional columns into the output csv file. 

# __Setup__

### **Downloading the covid data**
The html parser reads in the raw html page from the USC COVID data site. Since the page requires users to be logged into the USC Shibboleth SSO (which additonally requires a confirmation from DUO Push) users are required to manually download the covid data page html. To do this simply navigate to the USC COVID data page and hit `ctrl + s` on the keyboard. Once downloaded the user will need to move it into the `/html` directory.  

!!! warning
    Because of the inconsistant way the covid data is entered onto the site, older data might not be correctly parsed in the current state of the parser. This parser was designed on the 2022 January/Febuary datasets.

### **Setting up the building code map csv file for the building information files**
The `building_code_map.csv` should be included when you clone the repository. If needed, this file can be regenerated by following the steps in the [parse_building_directory.py](../parse_building_directory) page. The building map csv file name is defined in the `src/constants.py` file. 

# __Invocation__

To run parser.py from the base project directory simply type: `python src/parser.py` into your terminal from the base project directory. 

**Note:** All directory references made within the file use relative paths, so it will not matter what directory the user calls this script from. 

# __Output__ 

### **Base parsed output**
An example of an output csv is as follows:

```
class_name,code,weekday,start_time,end_time,location
AME-341B,28775,W,14:00,16:50,BHE301
AMST-101,10310,TH,09:30,10:50,MHP101
AMST-101,10312,F,11:00,11:50,GFS220
AMST-211,10300,MW,15:30,16:50,WPH207
...
```

The first line is always the header containing the name of each colomn. Below is a description of each colomn: 

| Column name | description                                       |
| ----------- | ------------------------------------------------- | 
| class_name  | Class name + code separated by hyphen             | 
| code        | Internal USC class code. Contains only numbers.   |
| weekday     | Characters for day of week. Subset of "MTWTHF"    |
| start_time  | Starting time (24 hr). Format is `hour:min`       |
| end_time    | Ending time (24 hr). Format is `hour:min`         |
| location    | (building) location name and room number          |

### **Building information appended**

If the optional append building location selection is made the example output would be as follows: 
```
class_name,code,weekday,start_time,end_time,location,full_building_name,building_address
AME-341B,28775,W,14:00,16:50,BHE301,Biegler Hall of Engineering,920 Downey Way
AMST-101,10310,TH,09:30,10:50,MHP101,Mudd Memorial Hall of Philosophy,3709 Trousdale Pkwy.
AMST-101,10312,F,11:00,11:50,GFS220,Grace Ford Salvatori Hall of Letters,Arts and Sciences 3601 Watt Way
AMST-211,10300,MW,15:30,16:50,WPH207,Waite Phillips Hall,3470 Trousdale Pkwy.
...
```

The two new collumns descriptions: 

| Column name         | description                                                      |
| ------------------- | ---------------------------------------------------------------- | 
| full_building_name  | Full name of building as presented on the USC building directory | 
| building_address    | Building address as presented on the USC building directory      |
